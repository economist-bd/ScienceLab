<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>বইয়ের বিস্তারিত | সাইন্সল্যাব</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <header>
        <a href="index.html" class="logo">সাইন্সল্যাব</a>
    </header>

    <div class="container">
        <div class="details-wrapper" id="details-container">
            <p>তথ্য লোড হচ্ছে...</p>
        </div>
    </div>

    <script type="module">
        import { db, doc, getDoc, collection, addDoc, serverTimestamp } from './firebase-config.js';

        const urlParams = new URLSearchParams(window.location.search);
        const productId = urlParams.get('id');
        const container = document.getElementById('details-container');

        async function loadProduct() {
            if (!productId) return;
            const docRef = doc(db, "products", productId);
            const docSnap = await getDoc(docRef);

            if (docSnap.exists()) {
                const data = docSnap.data();
                container.innerHTML = `
                    <div class="details-img">
                        <img src="${data.image}" alt="${data.title}">
                    </div>
                   <div class="details-info">
    <h1>${data.title}</h1>
    <div style="margin-top: 30px;">
        <h3>বিবরণ</h3>
        <div class="desc-text">${data.description}</div> </div>
</div>
                        <p>লেখক/প্রকাশনী: সাইন্সল্যাব</p>
                        <span class="price-tag">৳ ${data.price}</span>
                        <div style="background: #f9f9f9; padding: 20px; border-radius: 10px; border: 1px solid #eee;">
                            <h3>অর্ডার করতে নিচের তথ্য দিন:</h3>
                            <form id="order-form">
                                <div class="form-group">
                                    <input type="text" id="name" placeholder="আপনার নাম" required>
                                </div>
                                <div class="form-group">
                                    <input type="tel" id="phone" placeholder="মোবাইল নম্বর" required>
                                </div>
                                <div class="form-group">
                                    <input type="text" id="address" placeholder="ঠিকানা" required>
                                </div>
                                <button type="submit" class="buy-btn">অর্ডার কনফার্ম করুন</button>
                            </form>
                        </div>
                        <div style="margin-top: 30px;">
                            <h3>বিবরণ</h3>
                            <p>${data.description}</p>
                        </div>
                    </div>
                `;

                // অর্ডার সাবমিট হ্যান্ডলার
                document.getElementById('order-form').addEventListener('submit', async (e) => {
                    e.preventDefault();
                    const name = document.getElementById('name').value;
                    const phone = document.getElementById('phone').value;
                    const address = document.getElementById('address').value;

                    try {
                        await addDoc(collection(db, "orders"), {
                            product: data.title,
                            price: data.price,
                            customerName: name,
                            phone: phone,
                            address: address,
                            date: serverTimestamp()
                        });
                        alert("আপনার অর্ডারটি সফলভাবে গ্রহণ করা হয়েছে! আমরা দ্রুত যোগাযোগ করবো।");
                        window.location.href = "index.html";
                    } catch (error) {
                        alert("অর্ডার করতে সমস্যা হয়েছে। আবার চেষ্টা করুন।");
                        console.error(error);
                    }
                });

            } else {
                container.innerHTML = "<p>দুঃখিত, বইটি পাওয়া যায়নি।</p>";
            }
        }
        loadProduct();
    </script>
</body>
</html>
